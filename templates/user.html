{% extends 'base.html' %}
{% block content %}

  <a href="/logout">Logout</a>

  <br>
  <br>

  <div>
    <a href="/user/{{user_id}}/today">Today</a>
  </div>

  <div>
    <h1>My Medications</h1>
    {% for med in meds %}
    <div>
      <ul>
        <li>{{med[0]}}
        <ul>
          <li>Dose: {{med[1]}} {{med[2]}}</li>
          <li data-start="{{med[3].date()}}">Start date: {{med[3].date()}}</li>
          <li data-end="{{med[4].date()}}">End date: {{med[4].date()}}</li>
          <li><button id="{{med[5]}}" class="taken-btn" type="button">Taken</button></li>
          <li><button id="{{med[5]}}" class="remove-btn" type="button">Remove</button></li>
        </ul>
      </ul>
    </div>
    {% endfor %}
  </div>

    <!-- INSERT JAVASCRIPT HERE -->
  <script type="text/javascript">
    function confirmDrugRemoval(result) {
      alert(result);
      }

    function removeDrug() {
      confirm("Are you sure you want to remove this drug?");
      // console.log(this.id);
      // debugger;

      var formInputs = {
        "med_id": this.id,
        "start_date": $(this).parent().siblings(":nth-of-type(2)").data("start"),
        "end_date": $(this).parent().siblings(":nth-of-type(3)").data("end")
        };

    $.post("/remove-med",
           formInputs,
           confirmDrugRemoval
           );

    // Remove medication from user page.
    // this.parentElement.parentElement.parentElement.parentElement.remove()
    this.closest("div").remove()
    }

    $('.remove-btn').on('click', removeDrug);
  </script>
    <!-- END JAVASCRIPT -->


  <form action="/new-med">
    <input type="submit" id="add-med-button" value="Add a medication">
  </form>


{% endblock %}