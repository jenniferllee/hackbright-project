{% extends 'base.html' %}
{% block content %}
<!-- {% macro input(value='hello') -%}
  <input value="{{value}}"/>
{%- endmacro %} -->

  <div>
    <a href="/logout">Logout</a>
  </div>

  <div>
    <a href="/user">View All Medications</a>
  </div>

  <div>
    <a href="/user/today">Today</a>
  </div>

   <div>
    <a href="/user/compliance">Compliance</a>
  </div>

  <br>
  <br>

  <form action="/new-med" >
    <input type="submit" id="add-med-button" value="Add a medication">
  </form>

  <div>
    <h1>Today is: {{today}}</h1>
    {% for frequency in frequencies %}

    <div>
      <ul>
        <li>{{frequency.name}}
        <ul>
          <li>Dose: {{frequency.dose}} {{frequency.unit}}</li>
          {% for time in frequency.times %}
          <li data-time="time-{{time[0]}}">Scheduled time: {{time[0]}}
            <button id='{{time[1]}}' class="taken-btn" type="button">Taken</button>
            <img src="/static/checkmark.png" id="checkmark-{{time[1]}}" style={% if time[2] == True %}"display: inline"{% else %}"display: none"{% endif %} width='10' height='10'>
          </li>
          {% endfor %}
        </ul>
      </ul>
    </div>

    {% endfor %}
  </div>

    <!-- INSERT JAVASCRIPT HERE -->
  <script type="text/javascript">

    function confirmTaken(result) {
      alert(result);
      }

    // function makeTakenTrue() {
    //   console.log('made true')
    //   debugger;
    //   this.nextElementSibling.style.display = "inline";
    // }

    // function makeTakenFalse() {
    //   console.log('made false');
    //   this.nextElementSibling.style.display = "none";
    // }

    function changeTaken() {

      if ($(this).next().is(":hidden")) {

        // $(this).val('True');
        // console.log($(this).val());
        
        var formInputs = {
          "comp_id": this.id,
          "taken": true
          };

        $.post("/user/today/taken",
           formInputs,
           confirmTaken
           );

        $(this).next().show();
      }

      else if ($(this).next().is(":visible")) {
        
        // $(this).val('False');
        // console.log($(this).val());
        
        var formInputs = {
          "comp_id": this.id,
          "taken": false
          };

        // this.nextElementSibling.style.display = "inline"
        // this.nextElementSibling.style.display = "none"

        $.post("/user/today/taken",
             formInputs,
             confirmTaken
             );

        $(this).next().hide();
      }
    }

    $('.taken-btn').on('click', changeTaken);


  </script>
    <!-- END JAVASCRIPT -->

{% endblock %}